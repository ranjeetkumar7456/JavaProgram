pipeline {
    agent any
    
    options {
        timestamps()
        disableConcurrentBuilds()
        timeout(time: 60, unit: 'MINUTES')
    }

    environment {
        PHASE_1_STATUS = "PENDING"
        PHASE_2_STATUS = "PENDING"
        PHASE_3_STATUS = "PENDING"
        PHASE_4_STATUS = "PENDING"
        PHASE_5_STATUS = "PENDING"
        OVERALL_STATUS = "RUNNING"
    }

    stages {

        stage('üöÄ PHASE 1: SETUP') {
            steps {
                script {
                    echo "Running Phase 1"
                    env.PHASE_1_STATUS = "RUNNING"

                    def result = build job: 'JavaPractice-Phase1', wait: true, propagate: false

                    if (result.result == 'SUCCESS') {
                        env.PHASE_1_STATUS = "SUCCESS"
                    } else {
                        env.PHASE_1_STATUS = "FAILED"
                    }
                }
            }
        }

        stage('üîç PHASE 2: VALIDATION') {
            steps {
                script {
                    env.PHASE_2_STATUS = "RUNNING"
                    def result = build job: 'JavaPractice-Phase2', wait: true, propagate: false

                    env.PHASE_2_STATUS = (result.result == 'SUCCESS') ? "SUCCESS" : "FAILED"
                }
            }
        }

        stage('‚öôÔ∏è PHASE 3: COMPILATION') {
            steps {
                script {
                    env.PHASE_3_STATUS = "RUNNING"
                    def result = build job: 'JavaPractice-Phase3', wait: true, propagate: false

                    env.PHASE_3_STATUS = (result.result == 'SUCCESS') ? "SUCCESS" : "FAILED"
                }
            }
        }

        stage('üß™ PHASE 4: TESTING') {
            steps {
                script {
                    env.PHASE_4_STATUS = "RUNNING"
                    def result = build job: 'JavaPractice-Phase4', wait: true, propagate: false

                    env.PHASE_4_STATUS = (result.result == 'SUCCESS') ? "SUCCESS" : "FAILED"
                }
            }
        }

        stage('üì¶ PHASE 5: DEPLOYMENT') {
            steps {
                script {
                    env.PHASE_5_STATUS = "RUNNING"
                    def result = build job: 'JavaPractice-Phase5', wait: true, propagate: false

                    env.PHASE_5_STATUS = (result.result == 'SUCCESS') ? "SUCCESS" : "FAILED"
                }
            }
        }

        stage('üìä FINAL DASHBOARD') {
            steps {
                script {
                    def allPass = (
                        env.PHASE_1_STATUS == "SUCCESS" &&
                        env.PHASE_2_STATUS == "SUCCESS" &&
                        env.PHASE_3_STATUS == "SUCCESS" &&
                        env.PHASE_4_STATUS == "SUCCESS" &&
                        env.PHASE_5_STATUS == "SUCCESS"
                    )

                    env.OVERALL_STATUS = allPass ? "ALL SUCCESS" : "FAILED"

                    writeFile file: "master_dashboard.txt",
                    text: """
MASTER PIPELINE EXECUTION REPORT
================================

Phase 1 (Setup):       ${env.PHASE_1_STATUS}
Phase 2 (Validation):  ${env.PHASE_2_STATUS}
Phase 3 (Compilation): ${env.PHASE_3_STATUS}
Phase 4 (Testing):     ${env.PHASE_4_STATUS}
Phase 5 (Deployment):  ${env.PHASE_5_STATUS}

Overall Result: ${env.OVERALL_STATUS}

Build URL: ${env.BUILD_URL}
"""
                }

                archiveArtifacts artifacts: 'master_dashboard.txt', fingerprint: true
            }
        }
    }

    post {
        success {
            echo "üéâ ALL PHASES COMPLETED SUCCESSFULLY!"
        }
        failure {
            echo "‚ùå SOME PHASES FAILED ‚Äî Check Dashboard!"
        }
    }
}
